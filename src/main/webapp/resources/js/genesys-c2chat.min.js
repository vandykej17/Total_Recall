c2chat=function(){function e(e){function t(){"use strict";var e,t,a=l.Deferred,i="User";this.startSession=function(d){var p;return d.chatServerUrl||d.transport||o("either chatServerUrl or a custom transport must be provided"),t=d.logger||l.noop,e=s(d),p=new a,t("startSession: initializing transport"),e.init().fail(u(p,t)).done(function(){var a={"username":d.username,"userData":d.userData,"source":d.source,"subject":d.subject};a.username||(a.username=i),t("startSession: transport initialized, starting session ",a),e.startSession(a).done(function(a){t("startSession request returned ",a),t("startSession succeeded"),p.resolve(new n({"state":{"sessionId":a.sessionId||a.chatId,"chatServerUrl":d.chatServerUrl,"lastIndex":0},"transport":e,"stateStorage":r(d),"logger":t}))})}),c(p)},this.restoreSession=function(i){var o,p,f,m;return i=i||{},t=i.logger||l.noop,o=new a,p=r(i),f=p.read(),f&&f.sessionId?(e=s(l.extend({},i,{"chatServerUrl":f.chatServerUrl})),m={"state":f,"transport":e,"stateStorage":p,"logger":t},t("restoreSession: initializing transport"),e.init().fail(u(o,t)).done(function(){t("restoreSession: transport initialized, restoring the session ",m),o.resolve(new n(m))})):o.reject(d({"description":"restoreSession() failed to read state"})),c(o)}}function n(e){"use strict";function t(){o("session has ended")}function n(){V||t()}function a(){J("binding state saving"),l(window).on("pagehide.chat",function(){q.write(l.extend(e.state,{"lastIndex":z}))})}function s(){J("unbinding state saving"),l(window).off(".chat")}function r(e,t){J("replaying transcript"),l.each(e,function(e,n){var a=X[n.type];n.restored=!!t,a.event.fire(a.filter(n))})}function f(){return Q+"."+L}function m(){U&&(J("clearing history storage"),sessionStorage.removeItem(f()))}function h(){n(),J("fetching history from server"),_.getTranscript().done(function(e){J("fetched history from server ",e),e&&e.transcript&&(r(e.transcript,!0),R(e.transcript))})}function g(){var e,t;return!!U&&(e=JSON.parse(sessionStorage.getItem(f())),J("restoring history from storage ",e),!(!e||!e.length)&&(t=e[e.length-1].index,t!==z?(J("history and state indexes do not match",t,z),!1):(r(e,!0),R(e),!0)))}function v(){var e=g();e||h()}function y(){J("session ended, clearing up"),s(),m(),V=!1}function b(e){var t={};return t[G[e]]=!0,t}function T(e){return function(t){p(arguments,[{"isa":"function"}]),J("adding a callback for "+e),X[e].event.add(t)}}function x(e){var t={};return t[e.toLowerCase()]=!0,t}function I(e){}function S(e){}function C(e){}function w(e){}function D(e){return{"party":{"id":e.party.id,"name":e.party.name,"type":e.party.type},"index":e.index,"timestamp":e.timestamp,"restored":!!e.restored}}function k(e){return{"content":e.content,"timestamp":e.timestamp,"index":e.index,"restored":!!e.restored,"party":{"id":e.party.id,"name":e.party.name,"type":x(e.party.type)}}}function E(e){return{"party":{"id":e.party.id,"name":e.party.name,"type":e.party.type},"isTyping":e.isTyping,"index":e.index}}function A(e){return{"reason":b(e.reason.id),"restored":!!e.restored}}function N(e){return e=e||{},{"error":e.error||d().error,"restored":!!e.restored}}function $(e){var t=X[e];return l.each(t.innerListeners||[],function(e,n){t.event.add(n)}),function(n){if(J('got "'+e+'" raw transport event ',n),H)try{t.validate(n)}catch(t){return void X[O].event.fire(d({"code":0,"description":"Transport error in "+e+" event ("+t.message+")"}))}t.saveToHistory!==!1&&(R(n),n.index&&(z=n.index)),t.event.fire(t.filter(n))}}var U,R,O="Error",j="AgentConnected",P="AgentDisconnected",F="AgentTyping",M="MessageReceived",B="SessionEnded",H=!0,_=this,L=e.state.sessionId,K=e.transport,q=e.stateStorage,z=e.state.lastIndex,J=e.logger||l.noop,W=l.Deferred,Q="com.genesys.chat",V=!0,G=[void 0,"leaveRequest","agent","error"],X={};U=function(){try{return sessionStorage.setItem(Q,Q),sessionStorage.removeItem(Q),J("...supported"),!0}catch(e){return J("...not supported"),!1}}(),R=function(){var e=[];return U?function(t){"array"===l.type(t)?e=e.concat(t):e.push(t),J("saving history to storage ",e),sessionStorage.setItem(f(),JSON.stringify(e))}:l.noop}(),this.sendMessage=function(e){var t,a;return n(),"string"===l.type(e)&&(e={"message":e,"type":"text"}),p(e,{"message":"string","type":"string"}),"text"!==e.type&&"url"!==e.type&&o('type must be "url" or "text"'),t=new W,a={"sessionId":L,"message":e.message,"type":e.type},J("sending message ",a),K.sendMessage(a).fail(u(t,J)).done(function(){J("sending message done"),t.resolve()}),c(t)},this.getTranscript=function(e){var t,a;return n(),e=e||{"fromIndex":0},p(e,{"fromIndex":"number"}),e&&e.fromIndex<0&&o('"fromIndex" must be >= 0'),t=new W,a={"sessionId":L,"fromIndex":e&&e.fromIndex||0},J("sending getTranscript ",a),K.getTranscript(a).fail(u(t,J)).done(function(e){return J("getTranscript returned ",e),e&&e.transcript?void t.resolve({"transcript":e&&e.transcript}):void t.reject(d({"description":"No transcript came from transport"}))}),c(t)},this.sendTyping=function(e){var t,a={};return n(),e=e||{"isTyping":!0},p(e,{"isTyping":"boolean","typedText":{"isa":"string","optional":!0}}),a.isTyping=e.isTyping,a.sessionId=L,e.typedText&&(a.typedText=e.typedText),t=new W,J("sending sendTyping ",a),K.sendTyping(a).fail(u(t,J)).done(function(){J("sendTyping done"),t.resolve()}),c(t)},this.leave=function(){var e=new W;return n(),y(),J("sending leaveSession ",L),K.leaveSession({"sessionId":L}).fail(u(e,J)).done(function(t){J("leaveSession done ",t),t&&t.transcript&&(r(t.transcript,!1),R(t.transcript)),X[B].event.fire({"reason":b(1),"restored":!1}),e.resolve()}),c(e)},this.setUserData=function(e){var t,a;return n(),p({"params":e},{"params":"plainObject"}),t=new W,a={"userData":e,"sessionId":L},J("sending setUserData",a),K.setUserData(a).fail(u(t,J)).done(function(){J("setUserData done"),t.resolve()}),c(t)},this.getUserData=function(e){var t,a;return n(),"string"!==l.type(e)&&o("string key is required. Given: "+typeof e),t=new W,a={"keys":[e],"sessionId":L},J("sending getUserData ",a),K.getUserData(a).fail(u(t,J)).done(function(e){J("getUserData done ",e);var n=e&&e.userData;return n?void t.resolve({"userData":e&&e.userData||{}}):void t.reject(d({"description":"No userData came from transport"}))}),c(t)},this.deleteUserData=function(e){var t,a;return n(),"string"!==l.type(e)&&o("string key is required. Given: "+typeof e),t=new W,a={"keys":[e],"sessionId":L},J("sending deleteUserData ",a),K.deleteUserData(a).fail(u(t,J)).done(function(){J("deleteUserData done"),t.resolve()}),c(t)},X[j]={"validate":I,"filter":D,"event":new i},X[P]={"validate":I,"filter":D,"event":new i},X[M]={"validate":S,"filter":k,"event":new i},X[F]={"validate":C,"filter":E,"event":new i,"saveToHistory":!1},X[B]={"validate":w,"filter":A,"event":new i,"innerListeners":[y]},X[O]={"validate":l.noop,"filter":N,"event":new i},K.onError($(O)),K.onAgentConnected($(j)),K.onAgentDisconnected($(P)),K.onAgentTyping($(F)),K.onMessageReceived($(M)),K.onSessionEnded($(B)),this.onError=T(O),this.onAgentConnected=T(j),this.onAgentDisconnected=T(P),this.onAgentTyping=T(F),this.onMessageReceived=T(M),this.onSessionEnded=T(B),a(),0!==z&&v()}function a(e){"use strict";var t=(e=e||{}).cookieName||"gcState",n=e.domain,a="/",i=e.cookieMaxAge||5,s=e.logger||l.noop;return{"read":function(){var e=sessionStorage.getItem(t);return e?JSON.parse(e):e},"write":function(e){e&&(sessionStorage.setItem(t,JSON.stringify(e),{"path":a}),s("saved state with cookie name: ",t,", domain: ",n,", max age: ",i))}}}function i(){"use strict";var e=[],t=[];this.add=function(n){e.length&&l.each(e,function(e,t){n(t)}),t.push(n)},this.fire=function(n){e.push(n),l.each(t,function(e,t){t(n)})}}function s(e){return e&&e.transport||transport||!1}function r(e){return e.stateStorage||new a({"cookieMaxAge":e.cookieMaxAge,"log":e.logger})}function o(e){throw new TypeError("Genesys Chat: "+e)}function c(e){var t=e.promise();return{"done":t.done,"fail":t.fail}}function d(e){return e=e||{},{"error":{"code":e.code||0,"description":e.description}}}function u(e,t){return function(n){t("transport failed ",n),e.reject(d(n&&n.errors)),console.log("ERROR: Chat Widget: transport failed"),c2chat.handleChatUnavailable()}}function p(e,t){}var l=e||jquery||l||null;return t}function t(e){"use strict";function t(e){var t=e.promise();return{"done":t.done,"fail":t.fail}}function n(e){return setTimeout(e,0)}function a(e){var t={},n=!1,a=!1;switch(e.type){case"Message":e.type="MessageReceived";break;case"ParticipantJoined":e.type="AgentConnected";break;case"ParticipantLeft":e.type="AgentDisconnected";break;case"ParticipantRejoined":e.type="ParticipantRejoined";break;case"TypingStarted":e.type="AgentTyping",n=!0;break;case"TypingStopped":e.type="AgentTyping",n=!1;break;case"TranscriptSaveDone":e.type="TranscriptSaveDone";break;case"Notice":e.type="MessageReceived",a=!0}if(e.from&&e.from.type)switch(e.from.type){case"Client":e.from.type="Client";break;case"Agent":e.from.type="Agent";break;case"External":e.from.type="External"}return t.type=e.type,t.index=e.index,t.timestamp=(new Date).getTime(),t.isTyping="AgentTyping"===e.type?n:void 0,t.content=e.text?{"text":e.text,"type":a?"notice":"text"}:void 0,t.party={"id":e.from?parseInt(e.from.participantId):"","type":e.from?e.from.type:"","name":e.from?e.from.nickname:""},e.index>=0&&e.index>=x&&(x=e.index+1),t}function i(e){var t=!1;$.each(e.messages,function(){var e=a(this);return"AgentConnected"==e.type&&"External"==e.party.type?(t=!0,!1):void(w[e.type]&&w[e.type](e))}),e.chatEnded===!0&&(S=e.chatEnded,d.stopPoll(),t&&c2chat.handleChatUnavailable(c2chat.content.ERROR_UNSTAFFED))}function s(e,n,a){var i=new u,s=p;""!=m&&(s=s+"/"+m+(e||""));var r={"url":s,"type":n,"crossDomain":!0,"data":a,"headers":{"Content-Type":"application/x-www-form-urlencoded","apikey":l}},o={"sessionId":m,"api":e};return $.ajax(r).done(function(t,n,a){if(t.id&&(t.sessionId=t.id),t.alias&&(y=t.alias),0==t.statusCode)i.resolve(t||{});else{if(c2chat.eventHooks)try{o.status=t.status,t.statusCode&&(o.code=t.statusCode),c2chat.eventHooks.fireError(o)}catch(e){console.log("[EVENT_HOOK_ERROR:fireError]"+e.message)}i.reject(t||{}),e&&2!=t.statusCode||(d.stopPoll(),c2chat.handleChatUnavailable())}}).fail(function(e,t,n){if(c2chat.eventHooks)try{o.status=e.status,e.errors&&(o.errors=e.errors),c2chat.eventHooks.fireError(o)}catch(e){console.log("[EVENT_HOOK_ERROR:fireError]"+e.message)}0!=e.status&&(d.stopPoll(),c2chat.handleChatUnavailable()),i.reject(e||{})}),t(i)}function r(e,t,n,a,i,s,r){var o={"chatId":e,"timestamp":t,"secureKey":n,"alias":a,"userId":i,"subject":s,"nickname":r};sessionStorage.setItem("c2cSession",JSON.stringify(o),{"path":"/"})}function o(){var e=sessionStorage.getItem("c2cSession");e&&(e=JSON.parse(e),m||(m=e.chatId),h||(h=parseInt(e.timestamp,10)),v||(v=e.secureKey),y||(y=e.alias),g||(g=e.userId),b||(b=e.subject),T||(T=e.nickname))}function c(){sessionStorage.removeItem("c2cSession",{"path":"/"})}if(!e||e&&!e.id)return!1;var d=this,u=$.Deferred,p=e.dataURL.replace(/\/$/,""),l=e.apikey,f=e.tenantName||"Resources",m="",h="",g="",v="",y="",b="",T="",x=1,I=1,S=!1,C=new u,w={},D=!1,k=1e3;this.init=function(){return n(C.resolve),o(),t(C)},this.poll=function(e,t,n){this.getTranscript().done(function(e){i(e)})},this.startPoll=function(){this.stopPoll(),D=setInterval(function(){d.poll()},k),this.poll()},this.stopPoll=function(){clearInterval(D)},this.setFormData=function(t){e.formData=t},this.getChatData=function(){return{"chatid":m,"timestamp":h,"secureKey":v,"alias":y,"userId":g,"subject":b,"nickname":T}},this.updateOptions=function(t){for(var n in t)e[n]=t[n];return this},this.reset=function(){m="",g="",v="",y="",b="",T="",x=1,I=1},this.startSession=function(t){return this.reset(),b=e.formData.subject||"No Subject",T=e.formData.nickname||e.formData.firstname||"Anonymous",s("","POST",{"tenantName":f,"nickname":T,"firstName":e.formData.firstname||"","lastName":e.formData.lastname||"","emailAddress":e.formData.email||"","subject":b,"text":"","userData":e.userData||{}}).done(function(e){0==e.statusCode&&(m=e.chatId,h=e.messages[0].utcTime,v=e.secureKey,y=e.alias,g=e.userId,r(m,h,v,y,g,b,T)),d.startPoll()})},this.sendMessage=function(e){return s("/send","POST",{"tenantName":f,"message":e.message,"userId":g,"secureKey":v,"alias":y})},this.getTranscript=function(e){return s("/refresh","POST",{"tenantName":f,"secureKey":v,"alias":y,"userId":g,"transcriptPosition":x})},this.getChat=function(e){return s("","GET",{"tenantName":f,"secureKey":v,"alias":y,"userId":g})},this.leaveSession=function(e){this.stopPoll(),c();var n=t(new u);return S||(n=s("/disconnect","POST",{"tenantName":f,"alias":y,"secureKey":v,"userId":g})),n},this.sendTyping=function(e){var e=e||{};return e.isTyping?s("/startTyping","POST",{"tenantName":f,"alias":y,"secureKey":v,"userId":g}):s("/stopTyping","POST",{"tenantName":f,"alias":y,"secureKey":v,"userId":g})},this.setUserData=function(e){return s("/updateData","POST",{"tenantName":f,"alias":y,"secureKey":v,"userId":g,"userData":e.userData})},this.getUserData=function(e){return t(new u)},this.deleteUserData=function(e){return t(new u)},this.onAgentConnected=function(e){w.AgentConnected=e},this.onAgentTyping=function(e){w.AgentTyping=e},this.onAgentDisconnected=function(e){w.AgentDisconnected=e},this.onMessageReceived=function(e){w.MessageReceived=e},this.onSessionEnded=function(e){w.SessionEnded=e},this.onError=function(e){w.Error=e}}function n(n){function a(e){for(var t in e)j[t]=$(e[t],O)}function i(e){e.append($("<div>",{"class":"header-info"}).attr("tabindex",0).attr("aria-expanded",!1).append($("<span>",{"class":"hidden","text":"Live Chat"})).append($("<div>",{"class":"c2chat-logo"}).attr("aria-hidden",!0))).append($("<button>",{"class":"hide-button"}).attr("aria-expanded",!1)),a({"HideButton":".hide-button"})}function s(){var e=$("<div>",{"id":"accordion"}).appendTo($("<div>",{"id":"c2chat","class":"chat"}).appendTo("body"));$("<div>",{"id":"chat-header"}).appendTo(e);var t=$("<div>",{"id":"chat-container"}).appendTo(e);return O=e,a({"Container":"#chat-container","Chatheader":"#chat-header"}),c2chat.handleChatUnavailable=u,i(j.Chatheader),t}function r(){var e=j.Container,t=$("<div>",{"class":"initiation"}).appendTo(e);$("<div>",{"class":"window"}).appendTo(t).append($("<h2>",{"text":"Live Chat"})).append($("<div>",{"text":"To chat, please give us a little information."})).append($("<hr>")).append($("<div>",{"class":"form-input nickname"}).append($("<label>",{"text":"Name"}).attr("for","nickname")).append($("<input>",{"type":"text","id":"nickname","name":"nickname","class":"nickname","maxlength":"50"}).attr("placeholder","Names only please"))).append($("<div>",{"class":"form-input subject"}).append($("<label>",{"text":"How can we help?"}).attr("for","subject")).append($("<textarea>",{"type":"text","id":"subject","name":"subject","class":"subject","rows":"5","cols":"80","maxlength":"250"}).attr("autocomplete","off"))),$("<div>",{"class":"action"}).appendTo(t).append($("<button>",{"class":"submit","text":"Send"})),a({"Form":".initiation","Nickname":".nickname","Subject":".subject","Submit":".submit"}),j.Submit.click(function(){if(R.checkForm()){if(c2chat.eventHooks)try{c2chat.eventHooks.fireInitialized(n.formData)}catch(e){console.log("[EVENT_HOOK_ERROR:fireInitialized]"+e.message)}R.startSession()}}),X.firstName&&h(j.Nickname,X.firstName)}function o(e){var t=j.Chatheader;$("<div>",{"class":"message-badge"}).prependTo(t);var n=j.Container;$("<button>",{"class":"end-button","text":"End"}).appendTo(n);var i=$("<div>",{"class":"chatbox"}).appendTo(n);$("<div>",{"class":"window"}).appendTo(i).append($("<div>",{"class":"messages"}).attr("tabindex",0).append($("<div>",{"class":"transcript"})));var s=!1,r="",o="";e&&(s=!0,r="disabled",o="ui-button-disabled ui-state-disabled");var d="Email transcript";q&&(d="Edit email"),$("<div>",{"class":"action flip-container"}).appendTo(i).append($("<div>",{"class":"system-status"}).append($("<div>",{"class":"isTyping"}))).append($("<div>",{"class":"flipper"}).append($("<div>",{"class":"front"}).append($("<label>",{"class":"hidden","text":"Begin to chat here"}).attr("for","chat-input")).append($("<textarea>",{"type":"text","id":"chat-input","name":"chat-input","class":"input "+r,"rows":"5","cols":"80"}).attr("disabled",s).attr("autocomplete","off")).append($("<button>",{"class":"email-button "+o,"text":d})).append($("<button>",{"class":"send "+o,"text":"Send"}))).append($("<div>",{"class":"back"}).append($("<label>",{"text":"Send transcript to the address below:"}).attr("for","email")).append($("<input>",{"type":"text","id":"email","name":"email","class":"email-field","maxlength":"70"}).attr("placeholder","Enter email address")).append($("<span>",{"class":"notif"})).append($("<div>").append($("<button>",{"class":"cancel-button","text":"Cancel"})).append($("<button>",{"class":"save-button","text":"Save"}))))),a({"End":".end-button","MessageAlert":".message-badge","Chatbox":".chatbox","Messages":".messages","Transcript":".transcript","Input":".input","IsTyping":".isTyping","Flipper":".flipper","Front":".front","Back":".back","Email":".email-field","EmailButton":".email-button","CancelButton":".cancel-button","SaveButton":".save-button","Send":".send"}),z||""===z?(j.Front.hide(),j.Email.val(z),J&&D(J)):(j.Back.hide(),q||""===q?j.Email.val(q):h(j.Email,X.email));var u=576;if(te<u){var p=57,l=199,f=20,m=te-(p+l+f);O.css("max-height",te),O.find(".messages").css("max-height",m)}c()}function c(){var e=j.Container,t=$("<div>",{"class":"confirmation"}).appendTo(e);$("<div>",{"class":"window"}).appendTo(t).append($("<h2>",{"text":"End Chat"})).append($("<div>",{"text":"Are you sure you want to end this chat?"})).append($("<hr>")),$("<div>",{"class":"action"}).appendTo(t).append($("<button>",{"class":"no-button","text":"No"})).append($("<button>",{"class":"yes-button","text":"Yes"})),a({"Confirmation":".confirmation","No":".no-button","Yes":".yes-button"}),j.No.click(function(){v(_.CHATBOX),U(),V||R.resume(),j.Input.focus()}),j.Yes.click(function(){R.endSession(),R.close()})}function d(){var e=j.Container;$("<button>",{"class":"done-button","text":"Done"}).appendTo(e),j.HideButton.remove();var t=$("<div>",{"class":"survey"}).appendTo(e);t.append($("<iframe>").attr("height",500).attr("width",320).attr("frameBorder",0).attr("src","https://www.surveymonkey.com/r/5WDRRZZ")),a({"Done":".done-button","Survey":".survey"}),j.Done.click(function(){j.Done.remove(),$("<button>",{"class":"hide-button"}).appendTo(j.Chatheader),a({"HideButton":".hide-button"}),R.close()})}function u(e){j.Container.slideUp("fast",function(){if(j.Container.empty(),j.Chatheader.empty(),e)j.Chatheader.append($("<div>",{"class":"widget-error"}).append(e));else if(ee){var t=$("<a>").attr("href",ee).attr("target","_blank").text("contact us").click(function(e){e.stopPropagation()});j.Chatheader.append($("<div>",{"class":"widget-error"}).append("We're sorry. Nationwide chat is currently unavailable, for assistance please refer to our ").append(t).append(" page."))}else j.Chatheader.append($("<div>",{"class":"widget-error"}).append(c2chat.content.ERROR_DEFAULT))}),j.Container.remove(),Z()}function p(){R.validateAttachedData(),s();var e="false",t=0,n=sessionStorage.getItem("c2cSession"),a=sessionStorage.getItem("waitingForAgent"),i=sessionStorage.getItem("c2cAccordionState");i&&(i=JSON.parse(i),e=i.active,t=i.page,K=i.unread||0,W=i.lastReadIndex||-1,V=i.chatEnded,i.hasOwnProperty("emailTranscript")&&(q=i.emailTranscript),i.hasOwnProperty("emailVal")&&(z=i.emailVal,J=i.emailErrMsg||!1)),n&&t?(L=t,t===_.CHATBOX?(o(a),j.Container.addClass("chatting"),j.Confirmation.hide(),R.restoreSession()):t===_.CONFIRMATION&&(o(a),j.Chatbox.hide(),R.restoreSession())):r(),e&&"false"!=e?($("#c2chat #accordion").accordion({"collapsible":!0,"autoHeight":!0}),f(!0)):($("#c2chat #accordion").accordion({"collapsible":!0,"autoHeight":!0,"active":!1}),f(!1)),j.Chatheader.keydown(function(e){13==e.which&&l()}),j.Chatheader.click(function(e){l()})}function l(){var e=""+O.accordion("option","active");f("false"!==e)}function f(e){var t=j.HideButton;e?(t.text("Hide"),j.Chatheader.children().attr("aria-expanded",!0)):(t.text("Show"),j.Chatheader.children().attr("aria-expanded",!1))}function m(e){return!H[e]&&(H[e]=!0,!0)}function h(e,t){""==e.val()&&e.val(t||"")}function g(e,t){var a=j;a.Chatheader.click(function(){N(),U()}),e.onMessageReceived(function(e){if(m(e.index)){var t="system"==e.party.name&&e.party.type.external;"notice"==e.content.type?S(e.party.name,e.content.text):x(e.party.name,e.content.text,e.party.type.agent,t,e.index)}e.party.type.agent&&a.IsTyping.fadeOut()}),e.onAgentConnected(function(e){if(m(e.index))if("Agent"==e.party.type){if(sessionStorage.removeItem("waitingForAgent",{"path":"/"}),a.IsTyping.fadeOut(),a.Input.removeClass("disabled").attr("disabled",!1).focus(),a.Send.removeClass("ui-button-disabled ui-state-disabled").click(function(){T(),a.Input.focus()}),a.EmailButton.removeClass("ui-button-disabled ui-state-disabled").hide().fadeIn("fast").click(function(){k()}),a.CancelButton.click(function(){w(),a.Input.focus()}),a.SaveButton.click(function(){C(),a.Input.focus()}),x(e.party.name,(e.party.name||"Agent")+" has joined the chat.",!1,!0,e.index),c2chat.eventHooks)try{var i=n.userData;i.sessionId=G.getChatData().chatid,c2chat.eventHooks.fireSuccess(i)}catch(e){console.log("[EVENT_HOOK_ERROR:fireSuccess]"+e.message)}}else"Client"==e.party.type&&t&&a.IsTyping.html("Looking for an agent...").fadeIn()}),e.onAgentDisconnected(function(e){if(m(e.index))if("Agent"==e.party.type)x(e.party.name,(e.party.name||"Agent")+" Disconnected",!1,!0,e.index);else if("Client"==e.party.type){x(e.party.name,"Chat Ended",!1,!0,e.index),y(),a.IsTyping.fadeOut(),F=null,V=!0;var t=sessionStorage.getItem("waitingForAgent");t&&(G.stopPoll(),c2chat.handleChatUnavailable(c2chat.content.ERROR_UNSTAFFED))}}),e.onAgentTyping(function(e){m(e.index)&&"Agent"==e.party.type&&(e.isTyping?a.IsTyping.html((e.party.name||"Agent")+" is typing...").fadeIn():a.IsTyping.fadeOut())}),e.onSessionEnded(function(e){x("","Chat Ended",!1,!0,-1),y(),a.IsTyping.fadeOut(),F=null,V=!0}),a.Input.keypress(function(t){if(13==t.which&&!t.ctrlKey)return T(),t.preventDefault(),t.stopPropagation(),!0;if(e){var n=M;n.Interval?n.Timer=0:(e.sendTyping({"isTyping":!0}),n.Interval=setInterval(function(){n.Timer+=n.TimeInterval,n.Timer>=n.Timeout&&(clearInterval(n.Interval),n.Interval=!1,n.Timer=0,e.sendTyping({"isTyping":!1}))},n.TimeInterval))}})}function v(e){return _.CHATBOX==e?L==_.INITIATION?(o(!0),j.Chatbox.hide(),j.Confirmation.hide(),j.Form.slideUp("normal",function(){$(this).remove()}),j.Chatbox.slideDown("normal",function(){j.Container.addClass("chatting")})):L==_.CONFIRMATION&&(j.Confirmation.slideUp(),j.Chatbox.slideDown("normal",function(){j.Container.addClass("chatting")}),N()):_.CONFIRMATION==e?(j.Container.removeClass("chatting"),j.Chatbox.slideUp(),j.Confirmation.slideDown(),j.No.focus()):_.SURVEY==e&&(d(),j.Survey.hide(),j.Done.hide(),j.Confirmation.slideUp("normal",function(){$(this).remove(),A()}),j.Survey.slideDown("normal",function(){j.Done.show()})),L=e,setTimeout(function(){j.Container.css("height","auto")},0),this}function y(){j.Input.addClass("disabled").attr("disabled",!0),j.Send.attr("disabled",!0).addClass("ui-button-disabled ui-state-disabled"),j.Flipper.removeClass("email"),j.Email.addClass("disabled").attr("disabled",!0),j.EmailButton.attr("disabled",!0).addClass("ui-button-disabled ui-state-disabled").hide().fadeIn("fast"),j.CancelButton.attr("disabled",!0).addClass("ui-button-disabled ui-state-disabled"),j.SaveButton.attr("disabled",!0).addClass("ui-button-disabled ui-state-disabled"),j.IsTyping.fadeOut()}function b(){var e=G.getChatData(),t=new Date(e.timestamp),n=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear(),a=t.getHours(),i=t.getMinutes(),s=a>=12?"pm":"am";a%=12,a=a?a:12,i=i<10?"0"+i:i;var r=a+":"+i+s,o="(chat started on "+n+" at "+r+")";$("<div>",{"class":"welcome"}).attr("role","alert").attr("aria-live","assertive").prependTo(j.Messages).append($("<div>",{"text":"Nationwide "}).append($("<span>",{"class":"note","text":o}))).append($("<div>",{"text":"Your chat reference number is "+e.chatid+". This is a secure chat."})).append($("<div>",{"class":"note","text":c2chat.content.TRANSCRIPT_STARTUP})),x(e.nickname,e.subject,!1,!1,-1),setTimeout(function(){j.Container.css("height","auto")},0)}function T(){var e=j.Input.val().trim();""!=e&&F.sendMessage({"message":j.Input.val(),"type":"text"}),j.Input.val("")}function x(e,t,n,a,i){var s=j,r=$("<div>").attr("aria-atomic",!0).attr("role","alert"),o=$("<span>",{"class":"name","text":e}),c=$("<p>");a?r.addClass("system"):r.addClass(n?"them":"you"),c.append(I(t)),r.append(o).append(c),s.Transcript.append(r),r.fadeIn(),N();var d=""+O.accordion("option","active");i>W&&("false"===d&&(a||n)?(K+=1,s.MessageAlert.text(K),Q=i):W=i)}function I(e){function t(e){var t=e.toString(),n=null;if(/^www\./i.test(t))n="http://"+t;else{if(!/^https?:\/\//i.test(t))return t;n=t}return"<a href='"+n+"' target='_blank'>"+t+"</a>"}return e.replace(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/=]*)/gi,t)}function S(e,t){var n=window.open(t);if(!n){var a=$("<p class='notice them'><span class='name'></span><a href='' target='_BLANK'></a></p>");a.find(".name").text(e),a.find("a").text(t)[0].href=t,j.Transcript.append(a),a.fadeIn(),N()}}function C(){var e=j.Email,t=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/g.test(e.val());""!=e.val()&&(e.val().length>70||t===!1)?D("Invalid email address"):(q===!1&&(q=""),q!=e.val()&&(q=e.val(),n.userData.emailAddress=q,F.setUserData({"emailAddress":q}),q?j.EmailButton.text("Edit email"):j.EmailButton.text("Email transcript")),k(!0))}function w(){k(!0,function(){q||""===q?j.Email.val(q):j.Email.val(X.email||"")})}function D(e){var t=j.Email;J=e,t.next().addClass("input-error-message").text(J).attr("role","alert").attr("aria-live","assertive")}function k(e,t){e?(j.Flipper.removeClass("email"),j.Front.slideDown(),j.Back.slideUp(),j.Email.next().removeClass("input-error-message").text(" "),J=!1):(j.Flipper.addClass("email"),j.Front.slideUp(),j.Back.slideDown()),t&&t()}function E(){$(window).on("pagehide.chat",function(){var e={};L>0&&(e.page=L);var t=""+O.accordion("option","active");"false"!=t&&(e.active=t),W>-1&&(e.lastReadIndex=W),(q||""===q)&&(e.emailTranscript=q),j.Flipper&&j.Flipper.is(".email")&&(e.emailVal=j.Email.val(),J&&(e.emailErrMsg=J)),V&&(e.chatEnded=V),$.isEmptyObject(e)||sessionStorage.setItem("c2cAccordionState",JSON.stringify(e),{"path":"/"})})}function A(){j.MessageAlert.remove(),j.End.remove(),j.Chatbox.remove()}function N(){j.Messages.animate({"scrollTop":99999},100)}function U(){j.MessageAlert.empty(),K=0,Q>-1&&(W=Q,Q=-1)}var R=this,n=n||{},O={},j={},P=!1,F=null,M={"Timer":0,"Timeout":2e3,"TimeInterval":100,"Interval":!1},B=new(e($)),H={},_={"INITIATION":0,"CHATBOX":1,"CONFIRMATION":2,"SURVEY":3},L=0,K=0,q=!1,z=!1,J=!1,W=-1,Q=-1,V=!1,G=new t({"id":n.id,"tenantName":n.tenantName,"dataURL":n.dataURL,"apikey":n.apikey,"userData":n.userData,"skill":n.skill,"skillLevel":5,"CSRFURL":n.CSRFURL}),X=n.nwspa||{},Z=n.cleanup,Y=n.defaultBU,ee=n.contactUsUrl,te=$(window).height();this.updateNwspaData=function(e,t){if(F){var n={};n[e]=t,F.setUserData(n)}else X[e]=t},this.startSession=function(){return R.addAttachedData(),v(_.CHATBOX),E(),j.End.click(function(e){e.stopPropagation(),this.blur(),R.confirmEnd()}),G.updateOptions(n),G.setFormData&&G.setFormData(n.formData),B.startSession({"transport":G,"logger":n.logger}).done(function(e){V=!1,sessionStorage.setItem("waitingForAgent","true",{"path":"/"}),b(),g(e,!0),F=e,R.onStart()}),this},this.restoreSession=function(){var e=this;E(),j.End.click(function(t){t.stopPropagation(),this.blur(),e.confirmEnd()}),B.restoreSession({"transport":G,"logger":n.logger}).done(function(t){b();var n=sessionStorage.getItem("waitingForAgent");g(t,n),F=t,_.CHATBOX!=L||V?e.suspend():G.startPoll()})},this.endSession=function(){try{F&&!V&&(F.leave(),F=null),R.onEnd()}catch(e){console.log(e.message)}return this},this.checkForm=function(){var e=j.Form,t=!0,a=[];e.find(".input-error-message").remove(),n.formData={};var i=e.find("input[name='nickname']");i.val(i.val().trim());var s=new RegExp("^[a-zA-Z ']{1,50}$").test(i.val());""==i.val()?(a.push({"field":i,"errMsg":"Field is required"}),t=!1):s===!1?(a.push({"field":i,"errMsg":"Invalid name"}),t=!1):n.formData.nickname=i.val();var r=e.find("textarea[name='subject']");return r.val(r.val().trim()),""==r.val()?(a.push({"field":r,"errMsg":"Field is required"}),t=!1):n.formData.subject=r.val(),$(a).each(function(){var e=this.field,t=this.errMsg;e.before($("<span>",{"class":"input-error-message","text":t}).attr("role","alert").attr("aria-live","assertive"))}),t},this.validateAttachedData=function(){X.firstName&&X.firstName.length>50&&(X.firstName=""),X.middleInitial&&X.middleInitial.length>50&&(X.middleInitial=""),X.lastName&&X.lastName.length>50&&(X.lastName=""),X.nameSuffix&&X.nameSuffix.length>50&&(X.nameSuffix=""),X.email&&X.email.length>70&&(X.email=""),X.pageTitle&&X.pageTitle.length>100&&(X.pageTitle="")},this.addAttachedData=function(){n.formData.firstname=X.firstName||"",n.formData.lastname=X.lastName||"",n.formData.email="";for(var e in X)n.userData[e]=X[e];n.userData.nickname=n.formData.nickname||X.firstName||"",n.userData.subject=n.formData.subject||"",n.userData.emailAddress="",n.userData.BU||(n.userData.BU=X.BU||Y)},this.confirmEnd=function(){R.suspend(),v(_.CONFIRMATION)},this.updateOptions=function(e,t){if(t===!0)n=e||{};else for(var a in e)n[a]=e[a];return this},this.open=function(){return O.fadeIn(),R.onOpen(),this},this.close=function(){var e=null;return A(),e=j.Confirmation,R.clear(),R.onClose(e),setTimeout(function(){j.Container.css("height","auto")},0),this},this.clear=function(){var e=j;return e.Form&&e.Form.find("input, textarea").val(""),e.Chatbox&&(e.Input.val(""),e.Messages.empty(),e.IsTyping.fadeOut()),P=!1,F=null,H={},L=0,K=0,W=-1,Q=-1,q=!1,z=!1,J=!1,V=!1,Z(),this},this.suspend=function(){P||(P=!0,G.stopPoll(),R.onSuspend())},this.resume=function(){P&&(P=!1,G.startPoll(),R.onResume())},this.onOpen=function(){},this.onClose=function(e){e.slideUp("normal",function(){O.accordion("option","active",!1),f(!1),j.Chatheader.focus(),$(this).remove(),r()})},this.onStart=function(){},this.onStartFailed=function(){},this.onEnd=function(){},this.onSuspend=function(){},this.onResume=function(){},this.onOpenNewWindow=function(){},this.onCloseNewWindow=function(){},this.showErrorMessage=function(e){j.Container.empty(),j.Container.append($("<h3>",{"class":"window","text":e})),setTimeout(function(){j.Container.css("height","auto")},0)},p()}function a(){sessionStorage.removeItem("gcState",{"path":"/"}),sessionStorage.removeItem("c2cSession",{"path":"/"}),sessionStorage.removeItem("c2cAccordionState",{"path":"/"}),sessionStorage.removeItem("waitingForAgent",{"path":"/"}),c2chat.oGenesysWebChatInstance&&c2chat.oGenesysWebChatInstance.endSession(),$(window).off(".chat")}function i(e){if(c2chat.content={"TRANSCRIPT_STARTUP":"This chat session will be recorded for business purposes. Please do not include any sensitive personal information, like Social Security, driver's license, or credit card numbers.","ERROR_DEFAULT":"We're sorry. Nationwide chat is currently unavailable.","ERROR_UNSTAFFED":"We're sorry. Nationwide chat is currently unavailable."},e.content){var t=e.content;for(var n in t)t.hasOwnProperty(n)&&(c2chat.content[n]=t[n])}c2chat.nwspa=e.nwspa,c2chat.gmsEnvProp=e.env,c2chat.eventHooks=e.eventHooks;var i=e.preload||o,s=sessionStorage.getItem("c2cSession");s?o():(a(),c2chat.gmsEnvProp.enableStatsCheck?r(i):i())}function s(e,t,n,a){i({"preload":e,"nwspa":t,"env":n,"eventHooks":a})}function r(e,t){var n=c2chat.gmsEnvProp.defaultBU;c2chat.nwspa&&c2chat.nwspa.BU&&""!=c2chat.nwspa.BU&&(n=c2chat.nwspa.BU);
var a=c2chat.gmsEnvProp.maxQueueSize;isNaN(a)&&(a=3);var i={"statAgentsStaffed":{"objectId":c2chat.gmsEnvProp.statsAgentsObjectId,"objectType":"GroupAgents","tenant":"Resources","metric":"CurrNumberAgentsLoggedIn","notificationMode":"Immediate"},"statIxnsInQ":{"objectId":c2chat.gmsEnvProp.statsQueueObjectId,"objectType":"Queue","tenant":"Resources","metric":"CurrNumberWaitingCalls","notificationMode":"Immediate"}},s={"crossDomain":!0,"url":c2chat.gmsEnvProp.baseUrl+c2chat.gmsEnvProp.multiStatApiPath,"headers":{"apikey":c2chat.gmsEnvProp.apikey},"type":"POST","dataType":"json","contentType":"application/json; charset=UTF-8","data":JSON.stringify(i)};$.ajax(s).done(function(n,i,s){n.statAgentsStaffed>=1&&n.statIxnsInQ<a?e():t?(console.log("ERROR: Chat Widget: No agents are currently available"),t()):console.log("No agents are currently available")}).fail(function(e,n,a){var i="",s={"0":"Not connected.  Verify network.","400":"Server understood the request, but request content was invalid.","401":"Unauthorized access.","403":"Forbidden resource can't be accessed.","500":"Internal server error.","503":"Service unavailable."};"undefined"!=typeof e.status?(i=s[e.status],i||(i="Unknown Error")):i="parsererror"===n?"Requested JSON parse failed.":"timeout"===n?"Timeout error.":"abort"===n?"Ajax request aborted.":"Uncaught Error.  "+e.responseText,t?t("Unable to load widget."):console.log("Unable to load widget: "+i)})}function o(){c2chat.oGenesysWebChatInstance=new n({"userData":{"Chat_Source":"Nationwide Click-to-Chat","Entry_URL":'<a href="'+window.location.href+'">'+window.location.href+"</a>"},"id":"Resources","dataURL":c2chat.gmsEnvProp.baseUrl+c2chat.gmsEnvProp.chatApiPath,"apikey":c2chat.gmsEnvProp.apikey,"nwspa":c2chat.nwspa,"cleanup":a,"defaultBU":c2chat.gmsEnvProp.defaultBU,"contactUsUrl":c2chat.gmsEnvProp.contactUsUrl,"logger":c2chat.gmsEnvProp.logger})}function c(e,t){c2chat.oGenesysWebChatInstance.updateNwspaData(e,t)}return jQuery.support.cors=!0,window.XDomainRequest&&jQuery.ajaxTransport(function(e){if(e.crossDomain&&e.async){e.timeout&&(e.xdrTimeout=e.timeout,delete e.timeout);var t;return{"send":function(n,a){function i(e,n,i,s){t.onload=t.onerror=t.ontimeout=jQuery.noop,t=void 0,a(e,n,i,s)}t=new XDomainRequest,t.onload=function(){i(200,"OK",{"text":t.responseText},"Content-Type: "+t.contentType)},t.onerror=function(){i(404,"Not Found")},t.onprogress=jQuery.noop,t.ontimeout=function(){i(0,"timeout")},t.timeout=e.xdrTimeout||Number.MAX_VALUE,t.open(e.type,e.url),t.send(e.hasContent&&e.data||null)},"abort":function(){t&&(t.onerror=jQuery.noop,t.abort())}}}}),function(e){function t(e){return o.raw?e:encodeURIComponent(e)}function n(e){return o.raw?e:decodeURIComponent(e)}function a(e){return t(o.json?JSON.stringify(e):String(e))}function i(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(r," ")),o.json?JSON.parse(e):e}catch(e){}}function s(t,n){var a=o.raw?t:i(t);return e.isFunction(n)?n(a):a}var r=/\+/g,o=e.cookie=function(i,r,c){if(arguments.length>1&&!e.isFunction(r)){if(c=e.extend({},o.defaults,c),"number"==typeof c.expires){var d=c.expires,u=c.expires=new Date;u.setTime(+u+864e5*d)}return document.cookie=[t(i),"=",a(r),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}for(var p=i?void 0:{},l=document.cookie?document.cookie.split("; "):[],f=0,m=l.length;f<m;f++){var h=l[f].split("="),g=n(h.shift()),v=h.join("=");if(i&&i===g){p=s(v,r);break}i||void 0===(v=s(v))||(p[g]=v)}return p};o.defaults={},e.removeCookie=function(t,n){return void 0!==e.cookie(t)&&(e.cookie(t,"",e.extend({},n,{"expires":-1})),!e.cookie(t))}}($),!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return o.raw?e:encodeURIComponent(e)}function n(e){return o.raw?e:decodeURIComponent(e)}function a(e){return t(o.json?JSON.stringify(e):String(e))}function i(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(r," ")),o.json?JSON.parse(e):e}catch(e){}}function s(t,n){var a=o.raw?t:i(t);return e.isFunction(n)?n(a):a}var r=/\+/g,o=e.cookie=function(i,r,c){if(void 0!==r&&!e.isFunction(r)){if(c=e.extend({},o.defaults,c),"number"==typeof c.expires){var d=c.expires,u=c.expires=new Date;u.setTime(+u+864e5*d)}return document.cookie=[t(i),"=",a(r),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}for(var p=i?void 0:{},l=document.cookie?document.cookie.split("; "):[],f=0,m=l.length;m>f;f++){var h=l[f].split("="),g=n(h.shift()),v=h.join("=");if(i&&i===g){p=s(v,r);break}i||void 0===(v=s(v))||(p[g]=v)}return p};o.defaults={},e.removeCookie=function(t,n){return void 0!==e.cookie(t)&&(e.cookie(t,"",e.extend({},n,{"expires":-1})),!e.cookie(t))}}),{"config":i,"initChat":s,"createChatWidget":o,"updateNwspaData":c,"cleanChatSessionData":a}}();